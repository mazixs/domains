# Domain Availability Checker

Проверка доступности доменов с адаптивной валидацией: DNS (A/SOA) → HTTP → TCP → Ping.

## Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                      Входные данные                         │
│              list.txt (дубликаты удаляются)                 │
└─────────────────────┬───────────────────────────────────────┘
                      ▼
┌─────────────────────────────────────────────────────────────┐
│              asyncio.Semaphore(30)                          │
│         Ограничение параллельных задач                      │
└─────────────────────┬───────────────────────────────────────┘
                      ▼
┌─────────────────────────────────────────────────────────────┐
│   ┌──────────────┐     ┌──────────┐   ┌────────┐   ┌──────┐ │
│   │     DNS      │────▶│   HTTP   │──▶│  TCP   │──▶│ Ping │ │
│   │ A-record     │ YES │  HTTPS   │   │ :443   │   │ ICMP │ │
│   │    │         │     │  HTTP    │   │ :80    │   │      │ │
│   │    ▼         │     └────┬─────┘   └────┬───┘   └──┬───┘ │
│   │ SOA-record?  │          │              │          │     │
│   │ (Service)    │          │              │          │     │
│   └────┬─────────┘          │              │          │     │
│        │                    ▼              ▼          ▼     │
│        │                 SUCCESS?       SUCCESS?   SUCCESS? │
│        │                    │              │          │     │
│        ▼                    ▼              ▼          ▼     │
│     NO DNS               ALIVE          ALIVE      ALIVE    │
└─────────────────────────────────────────────────────────────┘
                      ▼
           ИТОГ: ALIVE = DNS OR HTTP OR TCP OR PING
                      ▼
┌─────────────────────────────────────────────────────────────┐
│              asyncio.as_completed()                         │
│       Результаты по мере готовности (без барьеров)          │
└─────────────────────────────────────────────────────────────┘
                      ▼
┌─────────────────────────────────────────────────────────────┐
│           Интерактивное удаление мёртвых доменов            │
│              (Y/N по каждому домену)                        │
└─────────────────────────────────────────────────────────────┘
```

## Логика проверки

Домен считается **ЖИВЫМ**, если прошла успешно **хотя бы одна** проверка.

| Шаг | Проверка | Детали | Результат |
|-----|----------|--------|-----------|
| 1 | **DNS** | Запрос A-записи (IPv4). Если нет — запрос **SOA** (для сервисных доменов без IP, например `oaiusercontent.com`). | Если есть A или SOA ➔ **Жив** |
| 2 | **HTTP** | Запрос HEAD/GET с поддержкой SNI и User-Agent. (Таймаут 10с) | Если код ответа получен ➔ **Жив** |
| 3 | **TCP** | Попытка соединения с портами 443 и 80. (Таймаут 5с) | Если порт открыт ➔ **Жив** |
| 4 | **Ping** | ICMP эхо-запрос. Работает даже если DNS не вернул IP (системный резолв). (Таймаут 5с) | Если есть ответ ➔ **Жив** |

**Особенности:**
- **SOA Fallback** — защита от удаления корневых сервисных доменов (CDN, Service Roots).
- **DNS Retry** — 2 попытки с паузой (защита от сбоев резолвера).
- **SNI поддержка** — корректная работа с CDN (Cloudflare, Instagram).
- **Smart Timeout** — увеличенные таймауты (10с DNS/HTTP) для медленных сетей.
- **Дедупликация** — автоматическое удаление дубликатов при загрузке.

## Файлы

| Файл | Назначение |
|------|------------|
| `list.txt` | Домены для проверки (комментарии `##` игнорируются) |
| `test.py` | Основной скрипт проверки |
| `requirements.txt` | Зависимости |

## Требования

- **Python**: 3.10+ (рекомендуется 3.11+)
- **ОС**: Windows / Linux / macOS

## Установка

```bash
# Виртуальное окружение
python -m venv .venv

# Активация
# Windows:
.venv\Scripts\activate
# Linux/macOS:
source .venv/bin/activate

# Зависимости
pip install -r requirements.txt
```

## Запуск

```bash
python test.py
```

**Пример вывода:**
```
Начало проверки 391 доменов...
Метод: DNS → HTTP → TCP → Ping

Прогресс: 391/391 (100.0%)

==================================================
Проверено: 391
Рабочих:   390
Мёртвых:   1

==================================================
Мёртвые домены:
  - example.com [DNS✗]

Удалить мёртвые домены из list.txt? (Y/N): y
Удалить 'example.com' [DNS✗]? (Y/N): y

Удалено: 1 доменов
```

## Зависимости

| Пакет | Назначение |
|-------|------------|
| `aiodns` | Асинхронные DNS-запросы через публичные серверы (1.1.1.1, 8.8.8.8, 9.9.9.9) |
| `aiohttp` | Асинхронные HTTP-запросы с поддержкой SNI |